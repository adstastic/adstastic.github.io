<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TIL: Downloading a postgres DB | ~/adi</title>
    <meta name="description" content="I&rsquo;m working on a website built with NextJS, deployed on Vercel, and using Payload as the CMS. The schemas are defined in TypeScript and Payload automatically applies changes1 so I want a copy of the DB in case I need to restore it.
pg_dump is the tool for this job - all it needs is a connection string.
$ pg_dump $POSTGRES_URL pg_dump: error: server version: 15.10; pg_dump version: 14.15 (Homebrew) pg_dump: error: aborting because of server version mismatch So I tried
">
    <link rel="canonical" href="http://localhost:1313/p/brew-postgres/">
    <link rel="alternate" type="application/rss+xml" title="~/adi" href="/feed.xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <script>
        
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                
                document.documentElement.classList.add('dark-theme');
            }
        })();
    </script>
</head>
<body>
    <div class="page-content relative py-8 px-6 mx-auto box-border max-w-[48rem] w-full">
        
<section class="site-header">
    <h1 class="smallcap"><a class="site-title" href="/">~/adi</a></h1>
    <nav>
    <a href="/about">About</a>
    <span>/</span>
    <a href="/feed.xml">RSS</a>
    <span>/</span>
    <label class="toggle-switch" for="dark-mode-toggle">
        <input type="checkbox" id="dark-mode-toggle" class="toggle-input">
        <span class="toggle-slider"></span>
    </label>
</nav>
</section>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">TIL: Downloading a postgres DB</h1>
        <p class="post-meta">
            <span class="post-meta-date">
                <time datetime="2025-01-29T00:00:00Z" itemprop="datePublished">Jan 29, 2025</time>
                
            </span>
            <span class="tags" itemprop="tags">
                
                <a href="/tags/til/">#til</a>
                
                <a href="/tags/databases/">#databases</a>
                
                <a href="/tags/dev/">#dev</a>
                
            </span>
        </p>
    </header>
    <div class="post-content" itemprop="articleBody">
        <p>I&rsquo;m working on a website built with <a href="https://nextjs.org/">NextJS</a>, deployed on <a href="https://vercel.com">Vercel</a>, and using <a href="https://payloadcms.com/">Payload</a> as the CMS. The schemas are defined in TypeScript and Payload automatically applies changes<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> so I want a copy of the DB in case I need to restore it.</p>
<p><a href="https://www.postgresql.org/docs/current/app-pgdump.html">pg_dump</a> is the tool for this job - all it needs is a connection string.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ pg_dump $POSTGRES_URL
</span></span><span class="line"><span class="cl">pg_dump: error: server version: 15.10; pg_dump version: 14.15 (Homebrew)
</span></span><span class="line"><span class="cl">pg_dump: error: aborting because of server version mismatch
</span></span></code></pre></div><p>So I tried</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">$</span> <span class="n">brew</span> <span class="n">upgrade</span> <span class="n">pg_dump</span>   
</span></span><span class="line"><span class="cl"><span class="o">==&gt;</span> <span class="n">Downloading</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">formulae</span><span class="o">.</span><span class="n">brew</span><span class="o">.</span><span class="n">sh</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">formula</span><span class="o">.</span><span class="n">jws</span><span class="o">.</span><span class="n">json</span>
</span></span><span class="line"><span class="cl"><span class="o">==&gt;</span> <span class="n">Downloading</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">formulae</span><span class="o">.</span><span class="n">brew</span><span class="o">.</span><span class="n">sh</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">cask</span><span class="o">.</span><span class="n">jws</span><span class="o">.</span><span class="n">json</span>
</span></span><span class="line"><span class="cl"><span class="n">Error</span><span class="p">:</span> <span class="n">No</span> <span class="n">available</span> <span class="n">formula</span> <span class="n">with</span> <span class="n">the</span> <span class="n">name</span> <span class="s2">&#34;pg_dump&#34;</span><span class="o">.</span> <span class="n">Did</span> <span class="n">you</span> <span class="n">mean</span> <span class="n">pgpdump</span><span class="p">,</span> <span class="n">pedump</span> <span class="ow">or</span> <span class="n">bgpdump</span><span class="err">?</span>
</span></span></code></pre></div><p>Right, it comes as part of <code>postgresql</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ brew upgrade postgresql
</span></span><span class="line"><span class="cl">Warning: Formula postgresql was renamed to postgresql@14.
</span></span><span class="line"><span class="cl">Warning: postgresql@14 14.15 already installed
</span></span></code></pre></div><p>It seems to default to <code>postgresql@14</code>, so I brew installed <code>postgresql@15</code>. Let&rsquo;s see if that worked</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ pg_dump -V
</span></span><span class="line"><span class="cl">pg_dump (PostgreSQL) 14.15 (Homebrew)
</span></span></code></pre></div><p>We need to replace the reference to 14 with 15.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ brew unlink postgresql@14
</span></span><span class="line"><span class="cl">Unlinking /opt/homebrew/Cellar/postgresql@14/14.15... 2165 symlinks removed.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ brew link postgresql@15
</span></span><span class="line"><span class="cl">Linking /opt/homebrew/Cellar/postgresql@15/15.10... 1600 symlinks created.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ pg_dump -V
</span></span><span class="line"><span class="cl">pg_dump (PostgreSQL) 15.10 (Homebrew)
</span></span></code></pre></div><p>Success!</p>
<p>And finally&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pg_dump $POSTGRES_URL &gt; db.sql
</span></span></code></pre></div><p>Now I separately need to back up the media, as that&rsquo;s stored in <a href="https://vercel.com/docs/storage/vercel-blob">Vercel Blob</a>.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Including destructive changes that will wipe your data! The price to pay for serverless, I guess.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

    </div>
    
    
    
    
    
    
    
        
        
            
            
                
            
                
            
                
                    
                
            
            
                
            
        
    
        
        
            
            
                
            
                
            
                
                    
                
            
            
                
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
                    
                
            
                
            
                
                    
                
            
            
                
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
    
    
    
    
    <div class="related-posts">
        <h3>Related Posts</h3>
        <ul>
        
            <li><a href="http://localhost:1313/p/kill-scp-loop/">TIL: Killing an scp loop</a></li>
        
            <li><a href="http://localhost:1313/p/claude-code-tips/">Claude Code Tips for SWE</a></li>
        
            <li><a href="http://localhost:1313/p/remote-control-claude-code/">Remote controlling Claude Code</a></li>
        
        </ul>
    </div>
    
    
    
    <hr>
</article>

<div class="copyright">
    <p>&copy; 2025 Adi Mukherjee. <a href="/credits">Credits</a>.</p>
</div>

    </div>
    
    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.getElementById('dark-mode-toggle');
            const body = document.body;
            const html = document.documentElement;
            
            
            const currentTheme = localStorage.getItem('theme') || 'light';
            
            
            if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'dark');
                html.classList.add('dark-theme');
                toggle.checked = true;
            } else {
                body.removeAttribute('data-theme');
                html.classList.remove('dark-theme');
                toggle.checked = false;
            }
            
            
            toggle.addEventListener('change', function() {
                if (this.checked) {
                    body.setAttribute('data-theme', 'dark');
                    html.classList.add('dark-theme');
                    localStorage.setItem('theme', 'dark');
                } else {
                    body.removeAttribute('data-theme');
                    html.classList.remove('dark-theme');
                    localStorage.setItem('theme', 'light');
                }
            });
        });
    </script>
</body>
</html>
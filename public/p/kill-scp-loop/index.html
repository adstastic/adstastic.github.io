<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TIL: Killing an scp loop | ~/adi</title>
    <meta name="description" content=" # Story Yesterday I fired off a quick loop to pull down some files from a server:
for f in $(cat file-list.txt); do scp user@hostname:path/to/data/$(basename $f) local_dir/ done I just needed a couple of examples1 so I decided to kill the command when I had them.
When I closed the shell, I expected everything to stop—but the downloads kept chugging away.
I ran ps aux | grep &#39;[s]cp&#39; and tried kill $PID, but got “no such process.”
">
    <link rel="canonical" href="https://adstastic.github.io/p/kill-scp-loop/">
    <link rel="alternate" type="application/rss+xml" title="~/adi" href="https://adstastic.github.io/feed.xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <script>
        
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                
                document.documentElement.classList.add('dark-theme');
            }
        })();
    </script>
</head>
<body>
    <div class="page-content">
        
<section class="site-header">
    <h1 class="smallcap"><a class="site-title" href="https://adstastic.github.io/">~/adi</a></h1>
</section>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">TIL: Killing an scp loop</h1>
        <p class="post-meta">
            <time datetime="2025-05-15T00:00:00Z" itemprop="datePublished">May 15, 2025</time>
            
            
            &middot; <span class="tags" itemprop="tags">
                
                <a href="/tags/til/">#til</a>
                
                <a href="/tags/dev/">#dev</a>
                
                <a href="/tags/shell/">#shell</a>
                
            </span>
            
        </p>
    </header>
    <div class="post-content" itemprop="articleBody">
        <h3 id="story">
  <a class="anchor" href="#story" aria-hidden="true">#</a>
  Story
</h3><p>Yesterday I fired off a quick loop to pull down some files from a server:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> f in <span class="k">$(</span>cat file-list.txt<span class="k">)</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  scp user@hostname:path/to/data/<span class="k">$(</span>basename <span class="nv">$f</span><span class="k">)</span> local_dir/
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div><p>I just needed a couple of examples<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> so I decided to kill the command when I had them.</p>
<p>When I closed the shell, I expected everything to stop—but the downloads kept chugging away.</p>
<p>I ran <code>ps aux | grep '[s]cp'</code> and tried <code>kill $PID</code>, but got “no such process.”</p>
<p>Opening <code>htop</code>, I saw the <code>scp</code> process but by the time I grabbed it&rsquo;s PID, it had finished.
I traced the parent with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ps -o pid,ppid,command -p <span class="k">$(</span>ps aux <span class="p">|</span> grep <span class="s1">&#39;[s]cp&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
</span></span></code></pre></div><p>Examining the parent showed it was <code>/bin/zsh</code>, so I killed that, but the downloads continued.</p>
<p>I traced the grandparent and found it to be <code>login</code>, which worried me because killing that would log me out.</p>
<p>How was this possible?</p>
<p><code>htop</code> has a nice Tree feature. This is the tree I was climbing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">├─ /Applications/Ghostty.app/Contents/MacOS/ghostty
</span></span><span class="line"><span class="cl">│  ├─ login
</span></span><span class="line"><span class="cl">│  │  └─ -/bin/zsh
</span></span><span class="line"><span class="cl">│  │     └─ scp
</span></span></code></pre></div><p>So I quit my terminal app (Ghostty.app), and the downloads stopped.</p>
<h3 id="learnings">
  <a class="anchor" href="#learnings" aria-hidden="true">#</a>
  Learnings
</h3><ul>
<li>
<p><strong>One-liner for fast-moving processes</strong>
Quickly inspect PID, PPID, command for processes that vanish too fast to track:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ps -o pid,ppid,command -p <span class="k">$(</span>ps aux <span class="p">|</span> grep <span class="s1">&#39;[s]cp&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
</span></span></code></pre></div></li>
<li>
<p><strong>htop’s tree mode</strong> makes it easy to inspect and kill at the right level of the process tree.</p>
</li>
<li>
<p><strong>ctrl-D exiting a tab in Ghostty might leave things running</strong> as the shell integration by default may not always detect background processes and loops when closing tabs. There are a number of settings to improve this e.g.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">shell-integration = zsh
</span></span><span class="line"><span class="cl">quit-after-last-window-closed = true
</span></span><span class="line"><span class="cl">wait-after-command = true
</span></span></code></pre></div><p>Quitting the app should clean these up, as all processes are nested under <code>ghostty</code>.</p>
<h3 id="footnotes">
  <a class="anchor" href="#footnotes" aria-hidden="true">#</a>
  Footnotes
</h3><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>That&rsquo;s what <code>head</code> is for? Yeah, I know, I know. <img src="/assets/cap-iknow.gif" alt="Captain America I Know">&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

    </div>
    
    
    
    
    
    
    
        
        
            
            
                
            
                
                    
                
            
                
            
            
                
            
        
    
        
        
            
            
                
            
                
                    
                
            
                
            
            
                
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
                    
                
            
                
                    
                
            
                
            
            
                
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
        
        
            
            
                
            
                
            
                
            
            
        
    
    
    
    
    
    <div class="related-posts">
        <h3>Related Posts</h3>
        <ul>
        
            <li><a href="https://adstastic.github.io/p/brew-postgres/">TIL: Downloading a postgres DB</a></li>
        
            <li><a href="https://adstastic.github.io/p/claude-code-tips/">Claude Code Tips for SWE</a></li>
        
            <li><a href="https://adstastic.github.io/p/remote-control-claude-code/">Remote controlling Claude Code</a></li>
        
        </ul>
    </div>
    
    
    
    <hr>
</article>

    </div>
    
    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.getElementById('dark-mode-toggle');
            const body = document.body;
            const html = document.documentElement;
            
            
            const currentTheme = localStorage.getItem('theme') || 'light';
            
            
            if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'dark');
                html.classList.add('dark-theme');
                toggle.checked = true;
            } else {
                body.removeAttribute('data-theme');
                html.classList.remove('dark-theme');
                toggle.checked = false;
            }
            
            
            toggle.addEventListener('change', function() {
                if (this.checked) {
                    body.setAttribute('data-theme', 'dark');
                    html.classList.add('dark-theme');
                    localStorage.setItem('theme', 'dark');
                } else {
                    body.removeAttribute('data-theme');
                    html.classList.remove('dark-theme');
                    localStorage.setItem('theme', 'light');
                }
            });
        });
    </script>
</body>
</html>